Monitoring Query Performance with Datadog
=========================================

`Datadog Deep Database Monitoring`_ can be used to track and visualize query metrics and
explain plans of Aiven for PostgreSQL® services.

.. _Datadog Deep Database Monitoring: https://www.datadoghq.com/product/database-monitoring/

Setup
-----

In order to use `Datadog Deep Database Monitoring`_ with your Aiven for PostgreSQL® services,
the following steps need to be performed:

* Outstanding maintenance updates that mention Datadog integration should be applied.
* :doc:`Datadog metrics integration </docs/integrations/datadog/datadog-metrics>` has to be enabled.
* The :doc:`PostgreSQL extensions </docs/products/postgresql/reference/list-of-extensions>`
  `pg_stat_statements` and `aiven_extras` need to enabled in every database of the service to be monitored:
::

    CREATE EXTENSION pg_stat_statements;
    CREATE EXTENSION aiven_extras;

* Datadog Databse Monitoring has to be enabled on the integration:
::

    # find the uuid of the Datadog integration for a particular service
    avn service integration-list --project <project name> <service name>

    # enable the database monitoring feature on for this integration
    avn service integration-update --user-config '{"datadog_dbm_enabled": true}' <integration uuid>

.. seealso:: Learn more about :doc:`/docs/integrations/datadog`.
.. _Datadog Deep Database Monitoring: https://www.datadoghq.com/product/database-monitoring/